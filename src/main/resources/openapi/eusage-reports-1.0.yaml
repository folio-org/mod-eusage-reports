openapi: 3.0.0
info:
  title: EUsage Reports
  version: v1
paths:
  /eusage-reports/report-titles:
    parameters:
      - $ref: headers/okapi-tenant.yaml
      - $ref: headers/okapi-token.yaml
      - $ref: headers/okapi-url.yaml
      - in: query
        name: counterReportId
        required: false
        description: limit titles associated with counter report (UUID)
        schema:
          type: string
    get:
      description: Get titles with links to KB
      operationId: getReportTitles
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: schemas/reportTitles.json
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      description: POST titles with links to KB
      operationId: postReportTitles
      requestBody:
        content:
          application/json:
            schema:
              $ref: schemas/reportTitles.json
      responses:
        "204":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
  /eusage-reports/report-titles/from-counter:
    parameters:
      - $ref: headers/okapi-tenant.yaml
      - $ref: headers/okapi-token.yaml
      - $ref: headers/okapi-url.yaml
    post:
      description: Parse counter reports
      operationId: postFromCounter
      requestBody:
        content:
          application/json:
            schema:
              $ref: schemas/fromCounterRequest.json
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: schemas/reportTitles.json
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
  /eusage-reports/title-data:
    parameters:
      - $ref: headers/okapi-tenant.yaml
      - $ref: headers/okapi-token.yaml
      - $ref: headers/okapi-url.yaml
    get:
      description: Get title data
      operationId: getTitleData
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: schemas/titleDataEntries.json
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
  /eusage-reports/report-data:
    parameters:
      - $ref: headers/okapi-tenant.yaml
      - $ref: headers/okapi-token.yaml
      - $ref: headers/okapi-url.yaml
    get:
      description: Return report data
      operationId: getReportData
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: schemas/reportDataEntries.json
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
  /eusage-reports/report-data/from-agreement:
    parameters:
      - $ref: headers/okapi-tenant.yaml
      - $ref: headers/okapi-token.yaml
      - $ref: headers/okapi-url.yaml
    post:
      description: Parse agreements and populate report data
      operationId: postFromAgreement
      requestBody:
        content:
          application/json:
            schema:
              $ref: schemas/fromAgreementRequest.json
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: schemas/fromAgreementResponse.json
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
components:
  responses:
    trait_400:
      description: Bad request
      content:
        text/plain:
          schema:
            type: string
            example: Invalid JSON in request
        application/json:
          schema:
            type: object
            example: {"error":"Invalid JSON in request"}
    trait_404:
      description: Not Found
      content:
        text/plain:
          schema:
            type: string
            example: Identifier 596d9f60-cda3-44d2-a4a1-2f48b7d4d23c not found
        application/json:
          schema:
            type: object
            example: {"error":"Identifier 596d9f60-cda3-44d2-a4a1-2f48b7d4d23c not found"}
    trait_500:
      description: Internal error
      content:
        text/plain:
          schema:
            type: string
            example: Internal server error, contact administrator
  schemas:
    errors:
      $ref: schemas/errors.json
